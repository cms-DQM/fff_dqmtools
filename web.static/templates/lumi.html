<div ng-controller="LumiRunCtrl">
  <div ng-show="LumiRunCtrl.runs.length && (!ParamsCtrl.params.hideRunBrowser)" class="runs alert-success alert run-browser">
    <a class="btn btn-xs close" ng-click="ParamsCtrl.setKey('hideRunBrowser', true)"> &times; </a>

    <label>
      <input type="checkbox" value="true" ng-model="ParamsCtrl.params.trackRun">
      Track newest (ongoing) run
    </label>

    <div ng-hide="ParamsCtrl.params.trackRun">
      <div class="alert-separator"></div>

      <div class="label-run"> Newest:
        <a ng-repeat="key in LumiRunCtrl.runs | limitTo:15" class="label-run label label-info" ng-click="ParamsCtrl.setKey('run', key)"> {{ key }} </a>
        <a ng-hide="LumiRunCtrl.runs.length"> no runs! </a>
      </div>

      <div class="alert-separator"></div>

      <form class="form-inline">
        <div class="form-group">
          <input type="text" typeahead="run for run in LumiRunCtrl.runs | filter:$viewValue | limitTo:8"
            class="form-control input-sm" ng-model="LumiRunCtrl.run_">
        </div>

        <button ng-show="LumiRunCtrl.run != LumiRunCtrl.run_" type="submit" class="btn btn-primary btn-sm" ng-click="ParamsCtrl.setKey('run', LumiRunCtrl.run_)"> go! </button>

        <button ng-show="LumiRunCtrl.previous_run" class="btn btn-default btn-sm" ng-click="ParamsCtrl.setKey('run', LumiRunCtrl.previous_run)"> previous: {{ LumiRunCtrl.previous_run }}</button>
        <button ng-show="LumiRunCtrl.next_run" class="btn btn-default btn-sm"     ng-click="ParamsCtrl.setKey('run', LumiRunCtrl.next_run)"> next: {{ LumiRunCtrl.next_run }}</button>

        <span> (total: {{ LumiRunCtrl.runs.length }} )</span>
      </form>
    </div>
  </div>



  <!--div ng-show="ParamsCtrl.params.run" class="page-header">
    <h2>Run <span class="label label-success">{{ LumiRunCtrl.run }}</span></h2>
  </div>

  <div ng-hide="ParamsCtrl.params.run" class="page-header">
    <h2>Run <span class="label label-success">undefined</span></h2>
  </div-->

  <div ng-hide="LumiRunCtrl.run">
    <ol class="breadcrumb">
      <li>
        <span class="blue">Run <strong>not selected</strong></span>
        <a ng-show="ParamsCtrl.params.hideRunBrowser" ng-click="ParamsCtrl.setKey('hideRunBrowser', null)" class="btn btn-info btn-xs">show run browser</a>
      </li>
    </ol>
  </div>

  <div ng-show="LumiRunCtrl.run">

    <ol class="breadcrumb">
      <li>
        <span class="blue">Run <strong>{{ LumiRunCtrl.run }}</strong></span>
        <a ng-show="ParamsCtrl.params.hideRunBrowser" ng-click="ParamsCtrl.setKey('hideRunBrowser', null)" class="btn btn-info btn-xs">show run browser</a>
      </li>
      <li>
        <span class="blue">File delivery graph</span>
        <a ng-hide="ParamsCtrl.params.showTimestampsGraph" ng-click="ParamsCtrl.setKey('showTimestampsGraph', true)" class="btn btn-info btn-xs">show</a>
        <a ng-show="ParamsCtrl.params.showTimestampsGraph" ng-click="ParamsCtrl.setKey('showTimestampsGraph', null)" class="btn btn-warning btn-xs">hide</a>
      </li>
    </ol>

    <div ng-if="ParamsCtrl.params.showTimestampsGraph">
      <div ng-controller="CachedDocumentCtrl" doc-id="LumiRunCtrl.type_dct_id['dqm-timestamps'][0]">
        <div ng-if="doc._header && (_.size(doc.extra.streams) != 0)">
          <graph-dqm-timestamps-lumi height="300" width="800" data="doc" />
        </div>
        <div ng-if="doc._header && (_.size(doc.extra.streams) == 0)">
          <p> No streams were delivered during this run. </p>
        </div>

        <div ng-show="doc && (!doc._header)"><p> Loading... </p></div>
        <div ng-show="!doc"><p>Graph not available for this run</p></div>
      </div>
    </div>

    <!--div class="page-header">
      <div class="scheme filter">
        <a ng-class="{ 'btn-default': !!LumiCtrl.ec_hide.success, 'btn-success': !LumiCtrl.ec_hide.success }" ng-click="LumiCtrl.ec_toggle('success')" class="btn btn-xs">running</a>
        <a ng-class="{ 'btn-default': !!LumiCtrl.ec_hide.warning, 'btn-warning': !LumiCtrl.ec_hide.warning }" ng-click="LumiCtrl.ec_toggle('warning')" class="btn btn-xs">stopped</a>
        <a ng-class="{ 'btn-default': !!LumiCtrl.ec_hide.danger,  'btn-danger' : !LumiCtrl.ec_hide.danger  }" ng-click="LumiCtrl.ec_toggle('danger')"  class="btn btn-xs">crashed</a>
      </div>
    </div-->

    <ol class="breadcrumb">
      <li>
        <span class="blue">Run <strong>{{ LumiRunCtrl.run }}</strong></span>
      </li>
      <li>
        <span class="blue">Known cmssw jobs</span>
        <a ng-hide="ParamsCtrl.params.showJobs" ng-click="ParamsCtrl.setKey('showJobs', true)" class="btn btn-info btn-xs">show</a>
        <a ng-show="ParamsCtrl.params.showJobs" ng-click="ParamsCtrl.setKey('showJobs', null)" class="btn btn-warning btn-xs">hide</a>
      </li>
    </ol>

    <div ng-if="ParamsCtrl.params.showJobs" ng-include="'templates/tableJobs.html'"></div>

  </div>

  <ol class="breadcrumb">
    <li>
      <span class="blue">Cluster stats</span>
      <a ng-hide="ParamsCtrl.params.showStats" ng-click="ParamsCtrl.setKey('showStats', true)" class="btn btn-info btn-xs">show</a>
      <a ng-show="ParamsCtrl.params.showStats" ng-click="ParamsCtrl.setKey('showStats', null)" class="btn btn-warning btn-xs">hide</a>
    </li>
  </ol>

  <div> 
    <div ng-if="ParamsCtrl.params.showStats" ng-include="'templates/tableStats.html'"></div>
  </div>
</div>
